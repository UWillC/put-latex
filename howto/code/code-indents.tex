\documentclass[polish]{article}

\usepackage[utf8]{inputenc}
\usepackage[OT1]{fontenc}

\usepackage[polish]{babel}

\usepackage[widespace]{fourier}
\usepackage[scaled]{luximono}

\usepackage{fancyvrb}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage[bookmarks=true,unicode]{hyperref}
\usepackage{url}
\usepackage{varioref}
\usepackage{listings}

% Custom floats
\usepackage{tocloft}
\usepackage{float}

% Set up hyperref.
\hypersetup{
  bookmarksopen=false,
  bookmarksopenlevel=3,
  bookmarksnumbered=true,
%
  colorlinks=false,
  citebordercolor=0.64 0.68 0.86,
  filebordercolor=0.64 0.68 0.86,
  linkbordercolor=0.64 0.68 0.86,
  menubordercolor=0.64 0.68 0.86,
  pagebordercolor=0.64 0.68 0.86,
  urlbordercolor=0.64 0.68 0.86,
  runbordercolor=0.64 0.68 0.86,
%
  pdfpagemode=UseOutlines,
  pdfstartview=Fit,
%
  pdftitle={},
  pdfauthor={},
  pdfkeywords={}
}

% Define colors for listings.
\definecolor{codestrings}{rgb}{0.164,0,1}
\definecolor{codecomment}{rgb}{0.25,0.49,0.37}
\definecolor{codekeywords}{rgb}{0.49,0,0.33}
\definecolor{codebackground}{rgb}{0.95,0.95,0.95}

% Set up defaults
\lstset{
	inputencoding=utf8,
	language=Java,
	extendedchars=true,
	basicstyle=\ttfamily\scriptsize,
	numbers=left,
  numbersep=3pt,
	framexleftmargin=2pt,
  framerule=0pt,
  frame=lines,
	numberstyle=\tiny,
	tabsize=2,
	showstringspaces=false,
	showspaces=false,
  keywordstyle=\bfseries\color{codekeywords},
  identifierstyle=\color{black},
  stringstyle=\color{codestrings},
  commentstyle=\color{codecomment},
  columns=fullflexible,
  abovecaptionskip=\medskipamount,
  belowcaptionskip=\medskipamount,
  backgroundcolor=\color{codebackground},  
}

\RecustomVerbatimEnvironment{Verbatim}{Verbatim}%
    {fontsize=\footnotesize,frame=lines,numbers=left}

\newlength{\codemargin}
\setlength{\codemargin}{\leftmargin}
\addtolength{\codemargin}{2pt}

\lstnewenvironment{javablock}{\lstset{language=Java}}{}
\lstnewenvironment{ljavablock}{\lstset{language=Java,resetmargins=true}}{}
\lstnewenvironment{mjavablock}{\lstset{language=Java,xleftmargin=\codemargin,numbers=none,framexleftmargin=2pt,numbersep=0pt}}{}

\newfloat{Program}{tbp}{lst}

\begin{document}

\noindent%
An example on the `top' level:

\begin{javablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{javablock}

\begin{itemize}
	\item And now indented:
\begin{javablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{javablock}

	\begin{itemize}
		\item And indented again:
\begin{javablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{javablock}
	\end{itemize}
\end{itemize}

\bigskip\noindent%
And now not indented (note it is the same option for \texttt{fancyvrb} and \texttt{listings} -- \texttt{resetmargins}).
An example on the `top' level:

\begin{ljavablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{ljavablock}

\begin{itemize}
	\item And now indented:
\begin{ljavablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{ljavablock}

	\begin{itemize}
		\item And indented again:
\begin{ljavablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{ljavablock}
	\end{itemize}
\end{itemize}

\pagebreak
\bigskip\noindent%
Now, if we want an arbitrary horizontal indent, we can specify that as well. For example, to
indent code blocks \emph{exactly} the amount of a typical list environment, you would do this:

\begin{itemize}
	\item Here is a list indent. The code below is not in the list, yet it appears
	exactly at the same distance from the left page margin.
\end{itemize}

\noindent\hspace{\leftmargin}\raisebox{0pt}[0pt][0pt]{\rule{0.5pt}{50pt}}

\begin{mjavablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{mjavablock}

\begin{itemize}
	\item Inside a list environment, this will still appear indented:
\begin{mjavablock}
public final class Example {
	public static void main(String [] args) {
	}
}
\end{mjavablock}
\end{itemize}

\end{document}
